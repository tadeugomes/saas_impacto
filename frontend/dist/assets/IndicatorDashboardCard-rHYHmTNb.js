import{r as R,j as e}from"./index-BpC5fKLh.js";import{D as k,P as F,b as P,A,p as O,c as T,C as W,B as q,g as I,d as G}from"./BarChart-BHjfVXWF.js";P.register(A,O,T);const H=["#3b82f6","#10b981","#f59e0b","#8b5cf6","#ec4899","#14b8a6","#6366f1","#f97316","#84cc16","#06b6d4"];function J({labels:t,data:r,title:a,variant:c="pie"}){const i=R.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{boxWidth:12,padding:8,font:{size:11}}},title:{display:!!a,text:a,font:{size:14,weight:"bold"}},tooltip:{callbacks:{label:o=>{const u=typeof o.raw=="number"?o.raw:0,m=o.dataset.data.filter(p=>typeof p=="number").reduce((p,j)=>p+j,0),d=(u/m*100).toFixed(1);return`${o.label}: ${u} (${d}%)`}}}}}),[a]),h=R.useMemo(()=>({labels:t,datasets:[{data:r,backgroundColor:H.slice(0,r.length),borderWidth:2,borderColor:"#fff"}]}),[t,r]),x=c==="doughnut"?k:F;return e.jsx("div",{className:"h-64 w-full flex items-center justify-center",children:e.jsx("div",{className:"w-full max-w-sm",children:e.jsx(x,{data:h,options:i})})})}function K(t){if(typeof t=="number")return Number.isFinite(t)?t:null;const r=Number(t);return Number.isFinite(r)?r:null}function E(t,r){const a=I(r);return G(t,a)}function Q(t){const r=new Map;return t.forEach(a=>{const c=r.get(a.label)??0;r.set(a.label,c+a.value)}),Array.from(r.entries()).map(([a,c])=>({label:a,value:c}))}function Z({title:t,description:r,unit:a,isLoading:c,data:i,chartType:h,valueField:x,labelField:o,fallbackLabel:u="N/A",filterText:b="",valueAccessor:f,labelAccessor:m,indicatorCode:d,topN:p=10,tableRows:j=5,error:M,warnings:v}){const D=R.useMemo(()=>{const n=(i==null?void 0:i.data)??[],w=[];for(const s of n){const C=f?f(s):s==null?void 0:s[x],V=K(C);if(V===null)continue;const g=m?m(s):o?s==null?void 0:s[o]:(s==null?void 0:s.id_municipio)||(s==null?void 0:s.nome_municipio)||(s==null?void 0:s.id_instalacao),B=g==null||g===""?u:String(g);w.push({label:B,value:V})}const z=b?w.filter(s=>s.label.toLowerCase().includes(b.toLowerCase())):w;return Q(z).sort((s,C)=>C.value-s.value)},[i,x,o,b,f,m,u]),l=D.slice(0,p),y=D.slice(0,j),S=I(d),L=l.length>0,N=v&&v.length>0?v.join(" | "):null,_=M??(L?null:N??"Sem dados para o filtro selecionado."),$=L&&N?N:void 0;return e.jsxs(W,{title:t,description:r,unit:a,isLoading:c,error:_??void 0,extraInfo:$,children:[h==="metric"?e.jsx("div",{className:"h-64 flex items-center justify-center",children:l.length>0?e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-4xl font-bold text-primary",children:E(l[0].value,d)}),e.jsx("p",{className:"text-gray-500 mt-2",children:"Maior valor observado"})]}):e.jsx("div",{className:"text-gray-400",children:"Sem dados disponÃ­veis"})}):h==="pie"?e.jsx(J,{labels:l.map(n=>n.label),data:l.map(n=>n.value),variant:"doughnut"}):e.jsx(q,{labels:l.map(n=>n.label),datasets:[{label:a??t,data:l.map(n=>n.value)}],yAxisLabel:a||t,valueFormat:S,horizontal:!0}),l.length>0&&y.length>0?e.jsxs("div",{className:"mt-4",children:[e.jsxs("p",{className:"text-xs font-semibold text-gray-600 mb-1",children:["Top ",y.length," em ranking"]}),e.jsx("div",{className:"overflow-auto",children:e.jsxs("table",{className:"w-full text-xs text-left",children:[e.jsx("thead",{className:"text-gray-500 border-b border-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-2 pr-3 font-medium",children:"Label"}),e.jsx("th",{className:"py-2 pr-3 font-medium text-right",children:"Valor"})]})}),e.jsx("tbody",{children:y.map(n=>e.jsxs("tr",{className:"border-b border-gray-50 last:border-b-0",children:[e.jsx("td",{className:"py-2 pr-3",children:n.label}),e.jsx("td",{className:"py-2 pr-3 text-right font-mono",children:E(n.value,d)})]},`${d}-${n.label}`))})]})})]}):e.jsx("p",{className:"mt-4 text-xs text-gray-400",children:"Sem dados para renderizar ranking."})]})}export{Z as I};
