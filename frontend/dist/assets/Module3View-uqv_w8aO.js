import{b as P,r as u,j as e}from"./index-BpC5fKLh.js";import{u as R,L as M,F as C,E as T,A as $,i as z}from"./indicators-CRvX9iZO.js";import{E as L,f as m,a as D,C as V,B,g as H}from"./BarChart-BHjfVXWF.js";const q={async getMultiplierEstimate(t,r,x=!1,j){const g={ano:r,use_causal:x};return j!==void 0&&(g.delta_tonelagem_pct=j),(await P.get(`/api/v1/employment/multipliers/${encodeURIComponent(t)}`,{params:g})).data}},_=[{code:"IND-3.01",name:"Empregos Portuários",unit:"Empregos",desc:"Total de empregos no setor portuário (RAIS)",valueField:"empregos_portuarios"},{code:"IND-3.02",name:"Paridade de Gênero",unit:"%",desc:"Percentual de mulheres no setor portuário",valueField:"percentual_feminino"},{code:"IND-3.04",name:"Taxa Emprego Temporário",unit:"%",desc:"Percentual de contratos temporários",valueField:"taxa_temporario"},{code:"IND-3.05",name:"Salário Médio",unit:"R$",desc:"Remuneração média mensal",valueField:"salario_medio"},{code:"IND-3.06",name:"Massa Salarial",unit:"R$",desc:"Massa salarial anual estimada",valueField:"massa_salarial_anual"},{code:"IND-3.07",name:"Produtividade",unit:"ton/emp",desc:"Toneladas movimentadas por empregado portuário",valueField:"ton_por_empregado"},{code:"IND-3.08",name:"Receita por Empregado",unit:"R$/emp",desc:"PIB por empregado portuário (proxy)",valueField:"pib_por_empregado_portuario"},{code:"IND-3.10",name:"Idade Média",unit:"Anos",desc:"Idade média dos trabalhadores portuários",valueField:"idade_media"},{code:"IND-3.11",name:"Variação Anual Empregos",unit:"%",desc:"Variação percentual anual de empregos",valueField:"variacao_percentual"},{code:"IND-3.12",name:"Participação Emprego Local",unit:"%",desc:"Participação do setor portuário no emprego total do município",valueField:"participacao_emprego_local"}];function Q(t){return(t||[]).filter(r=>/^\d{6,7}$/.test(String(r.id_municipio||""))).sort((r,x)=>(x.empregos_portuarios||0)-(r.empregos_portuarios||0)).slice(0,3).map(r=>String(r.id_municipio))}function O(t,r){return t[r]??t.valor??t.total??0}function U(t){return t.nome_municipio||t.municipio||t.id_municipio||t.id_instalacao||"N/A"}function J(){const{selectedYear:t,selectedInstallation:r}=R(),[x,j]=u.useState({}),[g,b]=u.useState(!0),[v,I]=u.useState(null),[y,w]=u.useState([]),[S,E]=u.useState(!1),[F,A]=u.useState(10);return u.useEffect(()=>{(async()=>{var a,i,n;b(!0),I(null),w([]);try{const c=_.map(d=>z.queryIndicator({codigo_indicador:d.code,params:{ano:t,id_instalacao:r||void 0}}).catch(o=>{var p,l;return console.error(`Erro ao buscar indicador ${d.code}:`,o),{data:[],error:((l=(p=o.response)==null?void 0:p.data)==null?void 0:l.detail)||o.message}})),N=await Promise.all(c),h={};N.forEach((d,o)=>{h[_[o].code]=d}),j(h),b(!1);const f=Q(((a=N[0])==null?void 0:a.data)||[]);if(f.length>0){E(!0);try{const d=f.map(l=>q.getMultiplierEstimate(l,t).catch(()=>null)),o=await Promise.all(d),p=[];for(const l of o)l!==null&&Array.isArray(l.data)&&l.data.length>0&&p.push(l);w(p)}catch{}finally{E(!1)}}}catch(c){console.error("Erro ao carregar indicadores do Módulo 3:",c),I(((n=(i=c.response)==null?void 0:i.data)==null?void 0:n.detail)||"Erro ao carregar indicadores"),b(!1)}})()},[t,r]),g?e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Módulo 3 - Recursos Humanos"}),e.jsx(M,{})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6 flex items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Módulo 3 - Recursos Humanos"}),e.jsx("p",{className:"text-gray-500 mt-1",children:"Painel de impacto em emprego e indicadores descritivos — dados RAIS + ANTAQ"})]}),e.jsx(L,{moduleCode:"3"})]}),e.jsx(C,{}),v&&e.jsx(T,{message:v,className:"mb-6"}),e.jsxs("div",{className:"mb-8 rounded-xl border border-amber-200 bg-amber-50 p-5",children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Painel de Impacto em Emprego"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-0.5",children:["Fonte: RAIS + ANTAQ · ",t," · Multiplicadores de literatura (UNCTAD / MInfra)"]})]}),e.jsxs("span",{className:"flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-semibold bg-amber-100 text-amber-700 border border-amber-200 whitespace-nowrap",children:[e.jsx($,{className:"w-3.5 h-3.5 flex-shrink-0"}),"Proxy literário · não causal"]})]}),S?e.jsx("div",{className:"py-6",children:e.jsx(M,{})}):y.length===0?e.jsx("p",{className:"text-sm text-gray-400 py-4 text-center",children:"Selecione um porto para visualizar o painel de impacto, ou aguarde disponibilização dos dados RAIS para os filtros atuais."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:y.map(s=>{var n;const a=(n=s.data)==null?void 0:n[0];if(!a)return null;const i=a.municipality_name||s.municipality_name||s.municipality_id;return e.jsxs("div",{className:"bg-white rounded-lg border border-amber-100 p-4 shadow-sm",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-3 text-sm truncate",title:i,children:i}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Empregos diretos"}),e.jsx("span",{className:"font-semibold text-gray-900",children:m(a.empregos_diretos)})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Indiretos (est.)"}),e.jsx("span",{className:"font-medium text-gray-700",children:m(Math.round(a.empregos_indiretos_estimados))})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-gray-500",children:"Induzidos (est.)"}),e.jsx("span",{className:"font-medium text-gray-700",children:m(Math.round(a.empregos_induzidos_estimados))})]}),e.jsxs("div",{className:"flex justify-between items-center border-t border-gray-100 pt-2",children:[e.jsx("span",{className:"font-semibold text-gray-700",children:"Total estimado"}),e.jsx("span",{className:"font-bold text-amber-700 text-base",children:m(Math.round(a.emprego_total_estimado))})]}),a.participacao_emprego_local!=null&&e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-400 pt-1 border-t border-gray-50",children:[e.jsx("span",{children:"Participação no emprego local"}),e.jsxs("span",{className:"font-medium",children:[D(a.participacao_emprego_local,2),"%"]})]}),a.empregos_por_milhao_toneladas!=null&&e.jsxs("div",{className:"flex justify-between items-center text-xs text-gray-400",children:[e.jsx("span",{children:"Eficiência (emp / 1 mi t)"}),e.jsx("span",{className:"font-medium",children:D(a.empregos_por_milhao_toneladas,1)})]})]})]},s.municipality_id)})}),e.jsxs("div",{className:"bg-white rounded-lg border border-amber-100 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-4 mb-4",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:"Simulação de Choque de Carga"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"deltaPct",className:"text-sm text-gray-500",children:"Variação de tonelagem:"}),e.jsx("input",{id:"deltaPct",type:"number",min:-50,max:100,step:5,value:F,onChange:s=>A(Number(s.target.value)),className:"w-20 px-2 py-1 text-sm border border-gray-300 rounded-md focus:outline-none focus:ring-1 focus:ring-amber-400"}),e.jsx("span",{className:"text-sm text-gray-500",children:"%"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left text-gray-500 border-b border-gray-100",children:[e.jsx("th",{className:"pb-2 pr-4 font-medium",children:"Município"}),e.jsx("th",{className:"pb-2 pr-4 font-medium text-right",children:"Δ Diretos"}),e.jsx("th",{className:"pb-2 pr-4 font-medium text-right",children:"Δ Indiretos"}),e.jsx("th",{className:"pb-2 pr-4 font-medium text-right",children:"Δ Induzidos"}),e.jsx("th",{className:"pb-2 font-medium text-right",children:"Δ Total"})]})}),e.jsx("tbody",{children:y.map(s=>{var l;const a=(l=s.data)==null?void 0:l[0];if(!a)return null;const i=F/100,n=Math.round(a.empregos_diretos*i),c=Math.round(a.empregos_indiretos_estimados*i),N=Math.round(a.empregos_induzidos_estimados*i),h=Math.round(a.emprego_total_estimado*i),f=h>=0,d=f?"+":"",o=f?"text-green-600":"text-red-600",p=a.municipality_name||s.municipality_name||s.municipality_id;return e.jsxs("tr",{className:"border-b border-gray-50 last:border-0",children:[e.jsx("td",{className:"py-2 pr-4 text-gray-700",children:p}),e.jsxs("td",{className:`py-2 pr-4 text-right font-medium ${o}`,children:[d,m(n)]}),e.jsxs("td",{className:`py-2 pr-4 text-right font-medium ${o}`,children:[d,m(c)]}),e.jsxs("td",{className:`py-2 pr-4 text-right font-medium ${o}`,children:[d,m(N)]}),e.jsxs("td",{className:`py-2 text-right font-bold ${o}`,children:[d,m(h)]})]},s.municipality_id)})})]})}),e.jsx("p",{className:"text-xs text-gray-400 mt-3",children:"Estimativa proporcional com base em multiplicadores de literatura. Hipótese linear simplificada — não constitui previsão causal."})]})]})]}),e.jsx("h2",{className:"text-base font-semibold text-gray-700 mb-4",children:"Indicadores Descritivos de Recursos Humanos"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:_.map(s=>{const a=x[s.code],i=(a==null?void 0:a.data)&&a.data.length>0,n=a==null?void 0:a.error;return e.jsx(V,{title:s.name,description:s.desc,unit:s.unit,isLoading:g,children:i?e.jsx(B,{labels:a.data.slice(0,10).map(c=>U(c)),datasets:[{label:s.unit,data:a.data.slice(0,10).map(c=>O(c,s.valueField))}],yAxisLabel:s.unit,horizontal:!0,valueFormat:H(s.code)}):e.jsx("div",{className:"h-64 flex flex-col items-center justify-center text-gray-400",children:n?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-red-500 mb-2",children:"Erro ao carregar dados"}),e.jsx("p",{className:"text-sm text-gray-500",children:n})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"Dados não disponíveis"}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Verifique os filtros ou aguarde disponibilização dos dados RAIS"})]})})},s.code)})})]})}export{J as Module3View};
