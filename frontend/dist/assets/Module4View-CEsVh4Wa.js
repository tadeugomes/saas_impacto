import{r as s,j as o}from"./index-BpC5fKLh.js";import{u as D,i as N,L as O,F as A,E as B}from"./indicators-CRvX9iZO.js";import{E as P}from"./BarChart-BHjfVXWF.js";import{n as d,i as q,t as R}from"./municipioLabels-6VdFVUhQ.js";import{I as U}from"./IndicatorDashboardCard-rHYHmTNb.js";const p=[{code:"IND-4.01",name:"Exportações",unit:"US$ FOB",desc:"Valor total das exportações",chartType:"bar",valueField:"valor_exportacoes_usd",labelField:"id_municipio"},{code:"IND-4.02",name:"Importações",unit:"US$ FOB",desc:"Valor total das importações",chartType:"bar",valueField:"valor_importacoes_usd",labelField:"id_municipio"},{code:"IND-4.03",name:"Balança Comercial",unit:"US$",desc:"Saldo comercial (Exp - Imp)",chartType:"bar",valueField:"balanca_comercial_usd",labelField:"id_municipio"},{code:"IND-4.04",name:"Peso Exportado",unit:"kg",desc:"Peso líquido das exportações",chartType:"bar",valueField:"peso_liquido_exportacoes_kg",labelField:"id_municipio"},{code:"IND-4.05",name:"Peso Importado",unit:"kg",desc:"Peso líquido das importações",chartType:"bar",valueField:"peso_liquido_importacoes_kg",labelField:"id_municipio"},{code:"IND-4.10",name:"Market Share",unit:"%",desc:"Participação no mercado nacional",chartType:"bar",valueField:"market_share_pct",labelField:"id_municipio"}],V=n=>({codigo_indicador:n,nome:n,unidade:"",unctad:!1,data:[]});function S(n){return n.data.filter(u=>u!==null&&typeof u=="object")}function J(){const{selectedYear:n,selectedInstallation:u}=D(),[m,M]=s.useState({}),[g,y]=s.useState(!0),[_,I]=s.useState(null),[v,k]=s.useState(""),[x,L]=s.useState("all"),[h,C]=s.useState({}),j=s.useCallback(async e=>{const t=Array.from(new Set(e.map(a=>d(a)).filter(a=>a&&a.length>=2&&!h[a])));if(t.length)try{const a=await N.getMunicipioLookup(t),r={};a.municipios.forEach(i=>{var f;const c=d(i.id_municipio),l=(f=i.nome_municipio)==null?void 0:f.trim();c&&l&&(r[c]=l)}),Object.keys(r).length>0&&C(i=>({...i,...r}))}catch{}},[h]),E=s.useMemo(()=>{const e={};return Object.values(m).forEach(t=>{S(t).forEach(a=>{const r=d(a.id_municipio),i=a.nome_municipio;r&&typeof i=="string"&&i.trim()&&!q(r,i)&&!d(i)&&(e[r]=i.trim())})}),e},[m]),b=s.useMemo(()=>({...h,...E}),[h,E]),F=s.useMemo(()=>{const e=new Set(Object.keys(b));return Object.values(m).forEach(t=>{S(t).forEach(a=>{const r=d(a.id_municipio);r&&e.add(r)})}),Array.from(e)},[m,b]);s.useEffect(()=>{j(F)},[F,j]);const T=s.useCallback(e=>{const t=d(e.id_municipio);return t?R(t,b):typeof e.nome_municipio=="string"&&e.nome_municipio.trim()?e.nome_municipio.trim():"N/A"},[b]);s.useEffect(()=>{(async()=>{var t,a;y(!0),I(null);try{const r=p.map(l=>N.queryIndicator({codigo_indicador:l.code,params:{ano:n,id_instalacao:u||void 0}}).catch(()=>V(l.code))),i=await Promise.all(r),c={};i.forEach((l,f)=>{c[p[f].code]=l}),M(c)}catch(r){const i=r,c=((a=(t=i==null?void 0:i.response)==null?void 0:t.data)==null?void 0:a.detail)||"Erro ao carregar indicadores";I(typeof c=="string"?c:"Erro ao carregar indicadores")}finally{y(!1)}})()},[n,u]);const w=s.useMemo(()=>x==="all"?p:p.filter(e=>e.code===x),[x]);return g?o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Módulo 4 - Comércio Exterior"}),o.jsx(O,{})]}):o.jsxs("div",{children:[o.jsxs("div",{className:"mb-6 flex items-start justify-between",children:[o.jsxs("div",{children:[o.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Módulo 4 - Comércio Exterior"}),o.jsx("p",{className:"text-gray-500 mt-1",children:"6 indicadores de comércio exterior"})]}),o.jsx(P,{moduleCode:"4"})]}),o.jsx(A,{}),o.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 mb-4",children:[o.jsxs("div",{children:[o.jsx("label",{className:"text-xs text-gray-500",children:"Buscar na série"}),o.jsx("input",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 mt-1",placeholder:"Filtrar nome no ranking",value:v,onChange:e=>k(e.target.value)})]}),o.jsxs("div",{children:[o.jsx("label",{className:"text-xs text-gray-500",children:"Indicador"}),o.jsxs("select",{className:"w-full border border-gray-300 rounded-lg px-3 py-2 mt-1",value:x,onChange:e=>L(e.target.value),children:[o.jsx("option",{value:"all",children:"Todos"}),p.map(e=>o.jsx("option",{value:e.code,children:e.name},e.code))]})]})]}),_&&o.jsx(B,{message:_,className:"mb-6"}),o.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:w.map(e=>o.jsx(U,{title:e.name,description:e.desc,unit:e.unit,isLoading:g,data:m[e.code],chartType:e.chartType,valueField:e.valueField,labelAccessor:t=>T(t),filterText:v,indicatorCode:e.code},e.code))})]})}export{J as Module4View};
