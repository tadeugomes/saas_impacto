import{r as p,j as i}from"./index-BpC5fKLh.js";import{u as Y,i as E,L as B,F as $,E as P,A as z}from"./indicators-CRvX9iZO.js";import{E as G,C as Q,g as A,B as k}from"./BarChart-BHjfVXWF.js";import{L as V}from"./LineChart-COZsv4d-.js";import{n as v,i as W,t as K}from"./municipioLabels-6VdFVUhQ.js";const X=6,S=[{code:"IND-6.01",name:"Arrecadação de ICMS",unit:"R$",desc:"ICMS arrecadado total no município.",valueField:"arrecadacao_icms",group:"tributacao",interpretation:"Mostra a capacidade fiscal municipal. Crescimentos fortes em anos de pico portuário sugerem potencial vínculo com atividade logística.",question:"Como uma melhora do porto X se reflete na arrecadação do município Y?"},{code:"IND-6.02",name:"Arrecadação de ISS",unit:"R$",desc:"ISS arrecadada total no município.",valueField:"arrecadacao_iss",group:"tributacao",interpretation:"Indicador de dinâmica da prestação de serviços. Em municípios com base portuária, sobe com serviços logísticos e manutenção.",question:"Qual parte do movimento econômico local está vinculada ao serviço associado ao porto?"},{code:"IND-6.03",name:"Receita Total Municipal",unit:"R$",desc:"Receita municipal total conforme FINBRA.",valueField:"receita_total",group:"tributacao",interpretation:"Base fiscal agregada do município. Útil para comparar escala de arrecadação entre municípios.",question:"O município com mais atividade portuária também concentra mais capacidade fiscal?"},{code:"IND-6.04",name:"Receita per Capita",unit:"R$/hab",desc:"Receita per capita.",valueField:"receita_per_capita",group:"percapita",interpretation:"Permite comparar capacidade fiscal por pessoa no tempo e reduzir viés de porte populacional.",question:"Como a carga econômica do porto altera a arrecadação disponível por habitante?"},{code:"IND-6.05",name:"Crescimento da Receita",unit:"%",desc:"Variação percentual anual da receita.",valueField:"crescimento_receita_pct",group:"desempenho",interpretation:"Não é causal isoladamente. Use junto de tendência de tonelagem e análise causal para inferir atribuição.",question:"A arrecadação cresce mais nos anos com maior movimento portuário?"},{code:"IND-6.06",name:"ICMS por Tonelada",unit:"R$/ton",desc:"Eficiência fiscal da movimentação portuária.",valueField:"icms_por_tonelada",group:"desempenho",interpretation:"Quanto ICMS é gerado por tonelada movimentada. Útil para avaliar retorno fiscal da operação.",question:"Quanto de ICMS o município ganha em média por tonelada movimentada?"},{code:"IND-6.07",name:"Receita Fiscal Total",unit:"R$",desc:"Soma de ICMS + ISS por município.",valueField:"receita_fiscal_total",group:"tributacao",interpretation:"Indicador mais comparável para impacto fiscal total ligado à atividade econômica local.",question:"Qual o impacto fiscal total potencialmente associado à dinâmica portuária?"},{code:"IND-6.08",name:"Receita Fiscal per Capita",unit:"R$/hab",desc:"Receita fiscal por habitante.",valueField:"receita_fiscal_per_capita",group:"percapita",interpretation:"Permite avaliar exposição fiscal por residente, não apenas pelo tamanho absoluto do município.",question:"O crescimento do movimento portuário melhora a arrecadação fiscal por habitante?"},{code:"IND-6.09",name:"Receita Fiscal por Tonelada",unit:"R$/ton",desc:"Receita fiscal total sobre movimentação física.",valueField:"receita_fiscal_por_tonelada",group:"desempenho",interpretation:"Mede retorno fiscal da operação portuária por unidade de tonelagem, evitando comparar municípios só por porte.",question:"A expansão do porto aumenta retorno fiscal por tonelada no município Y?"},{code:"IND-6.10",name:"Correlação Tonelagem e Receita Fiscal",unit:"coef.",desc:"Associação estatística entre tonelagem e receita fiscal.",valueField:"correlacao",valueAlias:"correlacao_tonelagem_receita_fiscal",group:"causal",interpretation:"Sem causalidade: mede associação (ou direção conjunta), não prova que a tonelagem causou a variação fiscal.",question:"O município é sensível à movimentação? (o sinal indica direção associativa)."},{code:"IND-6.11",name:"Elasticidade Tonelagem/Receita Fiscal",unit:"elastic.",desc:"Elasticidade log-log histórica.",valueField:"elasticidade",valueAlias:"elasticidade_tonelagem_receita_fiscal",group:"causal",interpretation:"Elasticidade > 0 indica relação direta histórica; |elasticidade| alto significa resposta mais intensa.",question:"Quanto a tonelagem tende a responder quando a base fiscal varia historicamente?"}],Z=S.reduce((a,e)=>(a[e.group]||(a[e.group]=[]),a[e.group].push(e),a),{}),H=a=>({codigo_indicador:a,nome:a,unidade:"",unctad:!1,data:[]});function J(a){if(typeof a=="number"&&Number.isFinite(a))return a;if(typeof a=="string"){const e=Number(a);return Number.isFinite(e)?e:null}return null}function w(a){if(typeof a=="number"&&Number.isFinite(a))return Math.trunc(a);if(typeof a=="string"){const e=Number.parseInt(a,10);return Number.isFinite(e)?e:null}return null}function U(a,e){const u=[e.valueAlias,e.valueField,"valor","total"].filter(f=>!!f);for(const f of u){const b=J(a[f]);if(b!==null)return b}return null}function aa(a,e){const u=v(a.id_municipio);return u?K(u,e):typeof a.nome_municipio=="string"&&a.nome_municipio||typeof a.porto=="string"&&a.porto||typeof a.id_instalacao=="string"&&a.id_instalacao||"N/A"}function ea(a){return a?a.data.filter(e=>e!==null&&typeof e=="object"):[]}function oa(a){const e=new Set;for(const{row:f}of a){const b=v(f.id_municipio)||"";e.add(b||"")}return(e.size===1?(e.has(""),1):e.size)===1}function ia(a){const e=a.map(c=>({...c,ano:w(c.row.ano)})).filter(c=>c.ano!==null),f=new Set(e.map(c=>c.ano)).size>1,b=oa(e);return!f||!b?null:(e.sort((c,I)=>c.ano-I.ano),{labels:e.map(c=>String(c.ano)),values:e.map(c=>c.value)})}function ta(a){return!a.warnings||a.warnings.length===0?[]:a.warnings.slice(0,2).map(e=>e.mensagem)}function sa({title:a,isOpen:e,onToggle:u}){return i.jsxs("button",{type:"button",className:"w-full flex items-center justify-between text-left",onClick:u,children:[i.jsx("h3",{className:"font-semibold text-gray-900",children:a}),i.jsx("span",{className:"text-sm text-indigo-600",children:e?"Ocultar":"Mostrar"})]})}function da(){const{selectedYear:a,selectedInstallation:e}=Y(),[u,f]=p.useState({}),[b,c]=p.useState(!0),[I,F]=p.useState(null),[y,D]=p.useState({}),[q,L]=p.useState({tributacao:!0,percapita:!0,desempenho:!0,causal:!0}),O=p.useCallback(s=>{L(d=>({...d,[s]:!d[s]}))},[]),R=p.useCallback(async s=>{const d=Array.from(new Set(s.map(t=>v(t)).filter(t=>t&&t.length>=2&&!y[t])));if(d.length)try{const t=await E.getMunicipioLookup(d),l={};t.municipios.forEach(o=>{var m;const n=v(o.id_municipio),x=(m=o.nome_municipio)==null?void 0:m.trim();n&&x&&(l[n]=x)}),Object.keys(l).length>0&&D(o=>({...o,...l}))}catch{}},[y]),M=p.useMemo(()=>{const s={};return Object.values(u).forEach(d=>{d.data.forEach(t=>{if(!t||typeof t!="object")return;const l=t,o=v(l.id_municipio),n=l.nome_municipio;o&&typeof n=="string"&&n.trim()&&!W(o,n)&&!v(n)&&(s[o]=n.trim())})}),s},[u]),N=p.useMemo(()=>({...y,...M}),[y,M]),C=p.useMemo(()=>{const s=new Set(Object.keys(N));return Object.values(u).forEach(d=>{d.data.forEach(t=>{if(!t||typeof t!="object")return;const l=v(t.id_municipio);l&&s.add(l)})}),Array.from(s)},[u,N]);return p.useEffect(()=>{R(C)},[C,R]),p.useEffect(()=>{(async()=>{var d,t;c(!0),F(null);try{const l=a-X,o=e?{id_instalacao:e,ano_inicio:l,ano_fim:a}:{ano:a},n=S.map(g=>{const h=g.code==="IND-6.10"||g.code==="IND-6.11"?e?{id_instalacao:e,min_anos:5}:{}:a?o:{};return E.queryIndicator({codigo_indicador:g.code,params:h}).catch(()=>H(g.code))}),x=await Promise.all(n),m={};x.forEach((g,h)=>{const _=S[h].code;m[_]=g}),f(m)}catch(l){const o=l,n=(t=(d=o==null?void 0:o.response)==null?void 0:d.data)==null?void 0:t.detail;F(typeof n=="string"?n:"Erro ao carregar indicadores")}finally{c(!1)}})()},[a,e]),b?i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-6",children:"Módulo 6 - Finanças Públicas"}),i.jsx(B,{})]}):i.jsxs("div",{children:[i.jsxs("div",{className:"mb-6 flex items-start justify-between",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Módulo 6 - Finanças Públicas"}),i.jsx("p",{className:"text-gray-500 mt-1",children:"11 indicadores de impacto fiscal com leitura causal e associativa"})]}),i.jsx(G,{moduleCode:"6"})]}),i.jsx($,{}),I&&i.jsx(P,{message:I,className:"mb-6"}),i.jsx("div",{className:"space-y-6",children:Object.entries(Z).map(([s,d])=>{const t=q[s],l=s==="tributacao"?"Imposição e Capacidade Fiscal":s==="percapita"?"Indicadores per capita":s==="desempenho"?"Eficiência e Retorno do Porto":"Relação e Sensibilidade (Associação)";return i.jsxs("section",{className:"card space-y-4",children:[i.jsx(sa,{title:l,isOpen:!!t,onToggle:()=>O(s)}),i.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:t&&d.map(o=>{const n=u[o.code],m=ea(n).map(r=>({row:r,value:U(r,o)})).filter(r=>r.value!==null),g=ta(n),h=ia(m),_=h?m.map(r=>({row:r.row,value:r.value,year:w(r.row.ano)})).filter(r=>r.year!==null).sort((r,j)=>r.year-j.year):m.sort((r,j)=>j.value-r.value).slice(0,10),T=m.length>0;return i.jsxs(Q,{title:o.name,description:o.desc,unit:o.unit,extraInfo:g.length?`Observações de validação: ${g.join(" | ")}`:o.interpretation,children:[T?h?i.jsx(V,{labels:h.labels,datasets:[{label:o.unit,data:h.values}],yAxisLabel:o.unit,yAxisFormat:A(o.code),yAxisBeginAtZero:o.group==="causal"}):i.jsx(k,{labels:_.map(r=>aa(r.row,N)),datasets:[{label:o.unit,data:_.map(r=>r.value)}],yAxisLabel:o.unit,valueFormat:A(o.code),horizontal:!0}):i.jsx("div",{className:"h-64 flex items-center justify-center text-gray-500 text-sm",children:o.group==="causal"?"Sem observações suficientes para cálculo causal (n<5 ou série insuficiente).":"Dados não disponíveis para o filtro atual."}),i.jsxs("div",{className:"mt-3 flex items-start gap-2 text-xs text-gray-500",children:[i.jsx(z,{className:"w-4 h-4 mt-0.5 text-indigo-500"}),i.jsx("p",{children:o.question})]})]},o.code)})})]},s)})})]})}export{da as Module6View};
